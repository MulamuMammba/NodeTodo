<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="grid-container" style="padding: 40px;">
        <div class="grid-item-intro glass">
            <h1><i class="fa-regular fa-pen-to-square"></i> To-do List:</h1>
        </div>

        <div class="grid-item-list glass">
            <div class="list-grid">
                <div class="list-container">
                    <h2 id="incompleteTasks">Incomplete Tasks</h1>
                    <ul id="todoList"></ul>
                </div>
                <div class="list-container">
                    <h2 id="completedTasks">Completed Tasks</h2>
                    <ul id="todoList2"></ul>
                </div>
            </div>
            
        </div>

        <div class="grid-item-add glass">
            <div class="row">
                <input type="text" id="todoInput" placeholder="Add a new task">
                <button class="add-button" onclick="addTask()">Add</button>
            </div>
        </div>
    </div>

    <script>
        async function loadTasks() {
    const response = await fetch('/todos');
    const tasks = await response.json();
    
    const list = document.getElementById('todoList');
    const list2 = document.getElementById('todoList2');
    
    list.innerHTML = '';
    list2.innerHTML = '';

    const completedTasks = tasks.filter(task => task.completed);
    const incompleteTasks = tasks.filter(task => !task.completed);

    const createListItems = (taskList, listElement) => {
        taskList.forEach((task) => {
            const listItem = document.createElement('li');

            const taskText = document.createElement('span');
            taskText.textContent = task.text;
            taskText.style.textDecoration = task.completed ? 'line-through' : 'none';

            const completeIcon = document.createElement('i');
            completeIcon.className = `${task.completed ? 'fas' : 'far'} fa-check-circle complete-icon`;
            completeIcon.title = task.completed ? 'Mark as Incomplete' : 'Mark as Complete';
            completeIcon.onclick = async () => {
                await toggleComplete(task.id);
                loadTasks();
            };

            const importantIcon = document.createElement('i');
            importantIcon.className = `${task.important ? 'fas' : 'far'} fa-star important-icon`;
            importantIcon.title = task.important ? 'Remove Importance' : 'Mark as Important';
            importantIcon.onclick = async () => {
                await toggleImportant(task.id);
                loadTasks();
            };

            const deleteIcon = document.createElement('i');
            deleteIcon.className = 'fas fa-trash delete-icon';
            deleteIcon.title = 'Delete Task';
            deleteIcon.onclick = async () => {
                await deleteTask(task.id);
                loadTasks();
            };

            listItem.appendChild(taskText);
            listItem.appendChild(completeIcon);
            listItem.appendChild(importantIcon);
            listItem.appendChild(deleteIcon);

            listItem.style.fontWeight = task.important ? 'bold' : 'normal';

            listElement.appendChild(listItem);
        });
    };

    createListItems(incompleteTasks, list);
    createListItems(completedTasks, list2);
}

const addTask = async () => {
    const input = document.getElementById('todoInput');
    const task = input.value.trim();
    if (task) {
        await fetch('/todos', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ task })
        });
        input.value = '';
        loadTasks();
    }
};

const toggleComplete = async (id) => {
    await fetch(`/todos/${id}/complete`, { method: 'PATCH' });
};

const toggleImportant = async (id) => {
    await fetch(`/todos/${id}/important`, { method: 'PATCH' });
};

const deleteTask = async (id) => {
    await fetch(`/todos/${id}`, { method: 'DELETE' });
};

loadTasks();

    </script>


</body>

</html>